import{a as S,u as L}from"./vue-router-hI8gbx6m.js";import{_ as N,a as w}from"./index-D9sq5B9z.js";import{ag as y,o as a,c as i,a as t,C as I,M as r,K as _,P as v,H as T,L as M,u as R,i as A,O as U,b as D,j as E,a4 as G,G as b}from"./@vue-JlwsckWB.js";import"./pinia-91x-qzso.js";import"./vue-demi-Dq6ymT-8.js";import"./element-plus-BCXmXNOW.js";import"./lodash-es-DpRhkxuT.js";import"./@vueuse-DS8A98-V.js";import"./@element-plus-Dbr4-WMN.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Cvt7qOjS.js";import"./artplayer-DYEsUqgO.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DVIT0l11.js";import"./axios-upsvKRUO.js";import"./vue-cookies-DmNBPvI0.js";import"./@fingerprintjs-BlNouByb.js";import"./tslib-BLN2B0TR.js";import"./vue-cropper-BAfMpYow.js";import"./mitt-DJ65BbbF.js";import"./moment-C5S46NFB.js";const q={class:"message-item"},B={class:"sys-info"},V={key:0,class:"resean"},j={key:1,class:"success"},O={class:"send-time"},P={class:"video-cover"},z={__name:"MessageSys",props:{data:{type:Object,default:{}}},emits:["delMessage"],setup(e,{emit:o}){const{proxy:f}=A();S();const c=o,C=u=>{c("delMessage",u)};return(u,l)=>{const p=y("router-link"),m=y("Cover");return a(),i("div",q,[t("div",B,[t("div",{class:I(["video-name iconfont",e.data.extendDto.auditStatus==3?"icon-success":"icon-error"])}," 视频 【"+r(e.data.videoName)+"】审核 "+r(e.data.extendDto.auditStatus==3?"成功":"失败"),3),e.data.extendDto.auditStatus!=3?(a(),i("div",V," 失败原因："+r(e.data.extendDto.messageContent),1)):_("",!0),e.data.extendDto.auditStatus==3?(a(),i("div",j,[v(p,{class:"a-link",to:`/video/${e.data.videoId}`,target:"_blank"},{default:T(()=>l[1]||(l[1]=[M("点击查看")])),_:1},8,["to"])])):_("",!0),t("div",O,[M(r(R(f).Utils.formatDate(e.data.createTime))+" ",1),t("span",{class:"iconfont icon-delete",onClick:l[0]||(l[0]=g=>C(e.data.messageId))})])]),t("div",P,[v(p,{to:`/video/${e.data.videoId}`,target:"_blank"},{default:T(()=>[v(m,{source:e.data.videoCover},null,8,["source"])]),_:1},8,["to"])])])}}},F=N(z,[["__scopeId","data-v-358e6b02"]]),H={class:"message-item"},K={class:"user-info-panel"},Y={class:"user-info"},J={class:"title-info"},Q={class:"comment"},W={key:0,class:"reply"},X={class:"send-time"},Z={class:"video-cover"},ee={__name:"MessageItem",props:{data:{type:Object,default:{}}},emits:["delMessage"],setup(e,{emit:o}){const{proxy:f}=A();S();const c=e,C={1:"系统消息",2:"点赞",3:"收藏",4:"评论"},u=()=>c.data.messageType==4?c.data.extendDto.messageContentReply?"在视频中回复了你的评论":"在视频中发表了评论":`${C[c.data.messageType]}了视频`,l=o,p=m=>{l("delMessage",m)};return(m,g)=>{const k=y("Avatar"),h=y("router-link"),x=y("Cover");return a(),i("div",H,[v(k,{avatar:e.data.sendUserAvatar,userId:e.data.sendUserId},null,8,["avatar","userId"]),t("div",K,[t("div",Y,[v(h,{to:`/user/${e.data.sendUserId}`,class:"user-name",target:"_blank"},{default:T(()=>[M(r(e.data.sendUserName),1)]),_:1},8,["to"]),t("span",J,r(u()),1)]),e.data.messageType==4?(a(),i(U,{key:0},[t("div",Q,r(e.data.extendDto.messageContent),1),e.data.extendDto.messageContentReply?(a(),i("div",W,r(e.data.extendDto.messageContentReply),1)):_("",!0)],64)):_("",!0),t("div",X,[M(r(R(f).Utils.formatDate(e.data.createTime))+" ",1),t("span",{class:"iconfont icon-delete",onClick:g[0]||(g[0]=s=>p(e.data.messageId))})])]),t("div",Z,[v(h,{to:`/video/${e.data.videoId}`,target:"_blank"},{default:T(()=>[v(x,{source:e.data.videoCover},null,8,["source"])]),_:1},8,["to"])])])}}},se=N(ee,[["__scopeId","data-v-1b2e59f8"]]),te={class:"message-panel"},ae={class:"left-panel"},oe=["onClick"],ne={key:0,class:"message-count"},de={class:"right-panel"},ie={key:0,class:"home"},re={key:1,class:"message-list"},ce={__name:"UserMessage",setup(e){const{proxy:o}=A(),f=S(),c=L(),C=w(),u=D([{name:"系统通知",messageTypeCode:"sys",messageType:1,noReadCount:0,icon:"icon-sys-message"},{name:"收到的赞",messageTypeCode:"like",messageType:2,noReadCount:0,icon:"icon-good"},{name:"收到收藏",messageTypeCode:"collection",messageType:3,noReadCount:0,icon:"icon-collection"},{name:"评论和@",messageTypeCode:"comment",messageType:4,noReadCount:0,icon:"icon-comment"}]),l=D({}),p=s=>{x(s),C.readMessageCount(s.noReadCount),l.value=s,f.push(`/message/${s.messageTypeCode}`),g()},m=D({}),g=async()=>{let s={pageNo:m.value.pageNo,messageType:l.value.messageType},d=await o.Request({url:o.Api.loadUserMessage,params:s});d&&(m.value=d.data)},k=s=>{o.Confirm({message:"确定要删除消息吗？",okfun:async()=>{await o.Request({url:o.Api.delMessage,params:{messageId:s}})&&g()}})};(async()=>{let s=await o.Request({url:o.Api.getNoReadCountGroup});s&&u.value.forEach(d=>{const $=s.data.find(n=>n.messageType==d.messageType);$&&(d.noReadCount=$.messageCount)})})();const x=async s=>{s.noReadCount==0||!await o.Request({url:o.Api.readAll,params:{messageType:s.messageType}})||(s.noReadCount=0)};return E(()=>{c.params.messageType&&(l.value=u.value.find(s=>s.messageTypeCode==c.params.messageType),g())}),(s,d)=>{const $=y("DataList");return a(),i("div",te,[t("div",ae,[d[0]||(d[0]=t("div",{class:"message-title"},"消息中心",-1)),(a(!0),i(U,null,G(u.value,n=>(a(),i("div",{class:I(["message-part",R(c).params.messageType==n.messageTypeCode?"active":""]),onClick:le=>p(n)},[t("div",{class:I(["iconfont",n.icon])},r(n.name),3),n.noReadCount>0?(a(),i("div",ne,r(n.noReadCount>99?"99+":n.noReadCount),1)):_("",!0)],10,oe))),256))]),t("div",de,[R(c).params.messageType?(a(),i("div",re,[v($,{dataSource:m.value,onLoadData:g},{default:T(({data:n})=>[n.messageType==1?(a(),b(F,{key:0,data:n,onDelMessage:k},null,8,["data"])):(a(),b(se,{key:1,data:n,onDelMessage:k},null,8,["data"]))]),_:1},8,["dataSource"])])):(a(),i("div",ie,d[1]||(d[1]=[t("div",{class:"iconfont icon-message"},null,-1)])))])])}}},we=N(ce,[["__scopeId","data-v-40617df1"]]);export{we as default};
