import{b as v,Z as K,j as A,ag as c,o as m,c as _,P as a,H as o,a as t,u as h,C as x,G as P,K as w,a5 as B,i as I,n as M}from"./@vue-JlwsckWB.js";import{a as S,u as $}from"./vue-router-hI8gbx6m.js";import{m as j}from"./js-md5-Ddb6WJu6.js";import{a as E}from"./index-D9sq5B9z.js";const F={class:"dialog-panel"},T={class:"bg"},G=["src"],H={class:"tab-panel"},O={key:1},Z={class:"check-code-panel"},J=["src"],Q={key:0},W={key:1},ae={__name:"Account",setup(X){const{proxy:n}=I();S(),$();const g=E(),k=v({}),C=async()=>{let i=await n.Request({url:n.Api.checkCode});i&&(k.value=i.data)},y=v({show:!0}),R=(i,e,d)=>{e!==s.value.registerPassword?d(new Error(i.message)):d()},r=v(1),s=v({}),V=v(),U={email:[{required:!0,message:"请输入邮箱"},{validator:n.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:n.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:R,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},q=()=>{C(),M(()=>{V.value.resetFields(),s.value={}})},b=()=>{V.value.validate(async i=>{if(!i)return;let e={};Object.assign(e,s.value),e.checkCodeKey=k.value.checkCodeKey,r.value==1&&(e.password=j(e.password));let d=await n.Request({url:r.value==0?n.Api.register:n.Api.login,params:e,errorCallback:()=>{C()}});d&&(r.value==0?(n.Message.success("注册成功,请登录"),f(1)):r.value==1&&(n.Message.success("登录成功"),g.setLogin(!1),g.saveUserInfo(d.data)))})},z=()=>{y.value.show=!1,g.setLogin(!1)},f=i=>{r.value=i,g.showLogin&&q()};return K(()=>{f(1)}),A(()=>{f(1)}),(i,e)=>{const d=c("el-divider"),p=c("el-input"),u=c("el-form-item"),L=c("el-button"),N=c("el-form"),D=c("Dialog");return m(),_("div",null,[a(D,{show:h(g).showLogin,buttons:y.value.buttons,width:"1000px",showCancel:!1,onClose:z,padding:0,draggable:!1,top:100},{default:o(()=>[t("div",F,[t("div",T,[t("img",{src:h(n).Utils.getLocalImage("login_bg.png")},null,8,G)]),a(N,{class:"login-register",model:s.value,rules:U,ref_key:"formDataRef",ref:V},{default:o(()=>[t("div",H,[t("div",{class:x([r.value==0?"":"active"]),onClick:e[0]||(e[0]=l=>f(1))}," 登录 ",2),a(d,{direction:"vertical"}),t("div",{class:x([r.value==1?"":"active"]),onClick:e[1]||(e[1]=l=>f(0))}," 注册 ",2)]),a(u,{prop:"email"},{default:o(()=>[a(p,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.email=l),maxLength:"150"},{prefix:o(()=>e[9]||(e[9]=[t("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),r.value==1?(m(),P(u,{key:0,prop:"password"},{default:o(()=>[a(p,{"show-password":"",size:"large",placeholder:"请输入密码",modelValue:s.value.password,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.password=l)},{prefix:o(()=>e[10]||(e[10]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})):w("",!0),r.value==0?(m(),_("div",O,[r.value==0?(m(),P(u,{key:0,prop:"nickName"},{default:o(()=>[a(p,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:s.value.nickName,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.nickName=l),maxLength:"20"},{prefix:o(()=>e[11]||(e[11]=[t("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1})):w("",!0),a(u,{prop:"registerPassword"},{default:o(()=>[a(p,{"show-password":"",type:"password",size:"large",placeholder:"请输入密码",modelValue:s.value.registerPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.registerPassword=l)},{prefix:o(()=>e[12]||(e[12]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(u,{prop:"reRegisterPassword"},{default:o(()=>[a(p,{"show-password":"",type:"password",size:"large",placeholder:"请再次输入密码",modelValue:s.value.reRegisterPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.reRegisterPassword=l)},{prefix:o(()=>e[13]||(e[13]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})])):w("",!0),a(u,{prop:"checkCode"},{default:o(()=>[t("div",Z,[a(p,{size:"large",placeholder:"请输入验证码",modelValue:s.value.checkCode,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.checkCode=l),onKeyup:B(b,["enter"])},{prefix:o(()=>e[14]||(e[14]=[t("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),t("img",{src:k.value.checkCode,class:"check-code",onClick:e[8]||(e[8]=l=>C())},null,8,J)])]),_:1}),a(u,{class:"bottom-btn"},{default:o(()=>[a(L,{type:"primary",size:"large",class:"login-btn",onClick:b},{default:o(()=>[r.value==0?(m(),_("span",Q,"注册")):w("",!0),r.value==1?(m(),_("span",W,"登录")):w("",!0)]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["show","buttons"])])}}};export{ae as _};
