import{ag as p,o as $,c as O,a as l,P as e,K as q,H as s,L as B,u as F,i as E,b as _,G as T,V as P,O as U,n as A,C as N}from"./@vue-o39Kj8Hc.js";import{u as z}from"./vue-router-B5Ds_jdF.js";import{_ as M,u as H}from"./index-Di0cqdVb.js";import"./pinia-DRS-luHF.js";import"./vue-demi-Dq6ymT-8.js";import"./element-plus-DqxZfY1O.js";import"./lodash-es-DpRhkxuT.js";import"./@vueuse-2MWXcMyd.js";import"./@element-plus-B683oq9Q.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Cvt7qOjS.js";import"./artplayer-DYEsUqgO.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DVIT0l11.js";import"./vue-cookies-DmNBPvI0.js";import"./vue-cropper-B5nAOkqF.js";import"./mitt-DJ65BbbF.js";import"./hls.js-DnSDjNdB.js";import"./artplayer-plugin-danmuku-CU64Le-w.js";import"./axios-upsvKRUO.js";import"./moment-C5S46NFB.js";const G={class:"cover-upload"},J={class:"cover"},K={__name:"ImageUpload",props:{modelValue:{type:[String,File]}},emits:["update:modelValue"],setup(S,{emit:d}){const{proxy:f}=E();z();const v=d,i=h=>{v("update:modelValue",h.file)},n=()=>{v("update:modelValue","")};return(h,y)=>{const r=p("Cover"),k=p("el-button"),V=p("el-upload");return $(),O("div",G,[l("div",J,[e(r,{source:S.modelValue},null,8,["source"]),S.modelValue?($(),O("div",{key:0,class:"iconfont icon-close",onClick:n})):q("",!0)]),e(V,{multiple:!1,"show-file-list":!1,"http-request":i,accept:F(f).imageAccept},{default:s(()=>[e(k,{class:"select-btn",type:"primary"},{default:s(()=>y[0]||(y[0]=[B("选择")])),_:1})]),_:1},8,["accept"])])}}},L=M(K,[["__scopeId","data-v-d84162d5"]]),Q={__name:"CategoryEdit",emits:["reload"],setup(S,{expose:d,emit:f}){const{proxy:v}=E(),i=_({show:!1,title:"新增分类",buttons:[{type:"primary",text:"确定",click:C=>{V()}}]}),n=_({}),h=_(),y={categoryCode:[{required:!0,message:"请输入分类编号"}],categoryName:[{required:!0,message:"请输入分类名称"}]};d({showEdit:C=>{i.value.show=!0,A(()=>{h.value.resetFields(),C.categoryId==null?i.value.title="新增分类":i.value.title="修改分类",n.value=Object.assign({},C)})}});const k=f,V=async()=>{h.value.validate(async C=>{if(!C)return;let t={};Object.assign(t,n.value),t.icon instanceof File&&(t.icon=await H(t.icon)),t.background instanceof File&&(t.background=await H(t.background)),delete t.children,await v.Request({url:v.Api.saveCategory,params:t})&&(i.value.show=!1,v.Message.success("保存成功"),k("reload"))})};return(C,t)=>{const I=p("el-input"),b=p("el-form-item"),o=p("el-form"),a=p("Dialog");return $(),T(a,{show:i.value.show,title:i.value.title,buttons:i.value.buttons,showCancel:!0,onClose:t[5]||(t[5]=c=>i.value.show=!1)},{default:s(()=>[e(o,{model:n.value,rules:y,ref_key:"formDataRef",ref:h,"label-width":"80px",onSubmit:t[4]||(t[4]=P(()=>{},["prevent"]))},{default:s(()=>[e(b,{label:"分类编号",prop:"categoryCode"},{default:s(()=>[e(I,{maxLength:10,modelValue:n.value.categoryCode,"onUpdate:modelValue":t[0]||(t[0]=c=>n.value.categoryCode=c),"show-word-limit":!0,maxlength:30},null,8,["modelValue"])]),_:1}),e(b,{label:"分类名称",prop:"categoryName"},{default:s(()=>[e(I,{maxLength:10,modelValue:n.value.categoryName,"onUpdate:modelValue":t[1]||(t[1]=c=>n.value.categoryName=c),"show-word-limit":!0,maxlength:30},null,8,["modelValue"])]),_:1}),n.value.pCategoryId===0?($(),O(U,{key:0},[e(b,{label:"图标",prop:"icon"},{default:s(()=>[e(L,{modelValue:n.value.icon,"onUpdate:modelValue":t[2]||(t[2]=c=>n.value.icon=c)},null,8,["modelValue"])]),_:1}),e(b,{label:"背景图",prop:"icon"},{default:s(()=>[e(L,{modelValue:n.value.background,"onUpdate:modelValue":t[3]||(t[3]=c=>n.value.background=c),width:300,height:150},null,8,["modelValue"])]),_:1})],64)):q("",!0)]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])}}},W={class:"header"},X={class:"cover"},Y={class:"category-background"},Z={class:"row-op-panel"},ee=["onClick"],te=["onClick"],oe=["onClick"],ae=["onClick"],le={class:"header"},se={class:"row-op-panel"},ne=["onClick"],ie=["onClick"],re=["onClick"],ce=["onClick"],ue={__name:"CategoryList",setup(S){const{proxy:d}=E();_(JSON.parse(sessionStorage.getItem("userInfo"))||{menuList:[]}),_({});const f=_({}),v=_({extHeight:0}),i=[{label:"图标",prop:"icon",scopedSlots:"icon",width:70},{label:"背景",prop:"background",scopedSlots:"background",width:180},{label:"分类编号",prop:"categoryCode",width:180},{label:"分类名称",prop:"categoryName"},{label:"操作",prop:"type",scopedSlots:"slotOperation",width:200}],n=i.slice(i.length-3,i.length),h=_(),y=async()=>{let o=await d.Request({url:d.Api.loadCategory});o&&(f.value.list=o.data,r.value==null&&o.data.length>0?(r.value=o.data[0],k.value.list=o.data[0].children):(r.value=o.data.find(a=>a.categoryId==r.value.categoryId),k.value.list=r.value.children),A(()=>{h.value.setCurrentRow("categoryId",r.value.categoryId)}))},r=_(null),k=_([]),V=o=>{k.value.list=o.children,r.value=o},C=o=>{d.Confirm({message:`确定要删除【${o.categoryName}】吗？`,okfun:async()=>{await d.Request({url:d.Api.delCategory,params:{categoryId:o.categoryId}})&&(d.Message.success("操作成功"),r.value.categoryId==o.categoryId&&(r.value=null),y())}})},t=async(o,a,c)=>{let m=o==0?f.value.list:r.value.children;if(c==="down"&&a==m.length-1||c=="up"&&a==0)return;let R=m[a],j=c=="down"?1:-1;m.splice(a,1),m.splice(a+j,0,R);let x=[];m.forEach(u=>{x.push(u.categoryId)}),await d.Request({url:d.Api.changeCategorySort,params:{pCategoryId:o,categoryIds:x.join(",")}})&&(d.Message.success("重新排序成功"),y())},I=_(),b=(o,a)=>{if(a==1&&!r.value){d.Message.warning("请先创建一级分类");return}a==0?o.pCategoryId=0:a==1&&Object.keys(o).length==0&&(o.pCategoryId=r.value.categoryId),I.value.showEdit(Object.assign({},o))};return(o,a)=>{const c=p("Cover"),m=p("el-divider"),R=p("Table"),j=p("el-card"),x=p("el-col"),D=p("el-row");return $(),O(U,null,[e(D,{gutter:10},{default:s(()=>[e(x,{span:16},{default:s(()=>[e(j,{class:"table-data-card"},{header:s(()=>[l("div",W,[a[2]||(a[2]=l("div",{class:"title"},"一级分类",-1)),l("div",{class:"btn",onClick:a[0]||(a[0]=u=>b({},0))},"新增分类")])]),default:s(()=>[e(R,{ref_key:"tableInfoRef",ref:h,columns:i,fetch:y,dataSource:f.value,options:v.value,extHeight:v.value.extHeight,showPagination:!1,onRowClick:V},{icon:s(({index:u,row:g})=>[l("div",X,[e(c,{source:g.icon,defaultImg:"default_image.png.png"},null,8,["source"])])]),background:s(({index:u,row:g})=>[l("div",Y,[e(c,{source:g.background,fit:"cover",defaultImg:"default_banner.png"},null,8,["source"])])]),slotOperation:s(({index:u,row:g})=>[l("div",Z,[l("a",{class:"a-link",href:"javascript:void(0)",onClick:w=>b(g,0)},"修改",8,ee),e(m,{direction:"vertical"}),l("a",{class:"a-link",href:"javascript:void(0)",onClick:w=>C(g)},"删除",8,te),e(m,{direction:"vertical"}),l("a",{href:"javascript:void(0)",onClick:w=>t(0,u,"up"),class:N([u==0?"disable":"a-link"])},"上移",10,oe),e(m,{direction:"vertical"}),l("a",{href:"javascript:void(0)",onClick:w=>t(0,u,"down"),class:N([u==f.value.list.length-1?"disable":"a-link"])},"下移",10,ae)])]),_:1},8,["dataSource","options","extHeight"])]),_:1})]),_:1}),e(x,{span:8},{default:s(()=>[e(j,{class:"table-data-card"},{header:s(()=>[l("div",le,[a[3]||(a[3]=l("div",{class:"title"},"二级分类",-1)),l("div",{class:"btn",onClick:a[1]||(a[1]=u=>b({},1))},"新增二分类")])]),default:s(()=>[e(R,{columns:F(n),dataSource:k.value,options:v.value,extHeight:v.value.extHeight,showPagination:!1},{slotOperation:s(({index:u,row:g})=>[l("div",se,[l("a",{class:"a-link",href:"javascript:void(0)",onClick:w=>b(g,1)},"修改",8,ne),e(m,{direction:"vertical"}),l("a",{class:"a-link",href:"javascript:void(0)",onClick:w=>C(g)},"删除",8,ie),e(m,{direction:"vertical"}),l("a",{href:"javascript:void(0)",onClick:w=>t(g.pCategoryId,u,"up"),class:N([u==0?"disable":"a-link"])},"上移",10,re),e(m,{direction:"vertical"}),l("a",{href:"javascript:void(0)",onClick:w=>t(g.pCategoryId,u,"down"),class:N([u==f.value.list.length-1?"disable":"a-link"])},"下移",10,ce)])]),_:1},8,["columns","dataSource","options","extHeight"])]),_:1})]),_:1})]),_:1}),e(Q,{ref_key:"categoryEditRef",ref:I,onReload:y},null,512)],64)}}},He=M(ue,[["__scopeId","data-v-3c9f3c0d"]]);export{He as default};
