import{u as me}from"./navActionStore-yUvuvR1j.js";import{_ as N,a as Y,m as T,b as ve,c as pe,d as ee}from"./index-D9sq5B9z.js";import{a as H,u as P}from"./vue-router-hI8gbx6m.js";import{o as p,c as b,M as C,D as z,b as k,m as j,j as G,S as te,ag as I,P as h,u as w,a as e,O as U,H as g,K as E,V as ie,a4 as W,G as D,L as V,i as q,C as M,n as ae,l as ue,z as oe,Z as fe,I as ne,Q as se,W as _e}from"./@vue-JlwsckWB.js";import{H as ce}from"./hls.js-DnSDjNdB.js";import{A as J}from"./artplayer-DYEsUqgO.js";import{a as ye}from"./artplayer-plugin-danmuku-DFoqE_xn.js";import"./pinia-91x-qzso.js";import"./vue-demi-Dq6ymT-8.js";import"./element-plus-BCXmXNOW.js";import"./lodash-es-DpRhkxuT.js";import"./@vueuse-DS8A98-V.js";import"./@element-plus-Dbr4-WMN.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Cvt7qOjS.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DVIT0l11.js";import"./axios-upsvKRUO.js";import"./vue-cookies-DmNBPvI0.js";import"./@fingerprintjs-BlNouByb.js";import"./tslib-BLN2B0TR.js";import"./vue-cropper-BAfMpYow.js";import"./mitt-DJ65BbbF.js";import"./moment-C5S46NFB.js";const F={COMMENT_LIKE:{value:0,desc:"评论喜欢点赞"},COMMENT_HATE:{value:1,desc:"评论讨厌"},VIDEO_LIKE:{value:2,desc:"视频点赞"},VIDEO_COLLECT:{value:3,desc:"视频收藏"},VIDEO_COIN:{value:4,desc:"视频投币"}},he={__name:"Tag",props:{type:{type:Number}},setup(i){H(),P();const c={0:{text:"置顶",color:"#FF6699"}};return(u,m)=>(p(),b("div",{class:"tag",style:z({border:`1px solid ${c[i.type].color}`,color:`${c[i.type].color}`})},C(c[i.type].text),5))}},Ce=N(he,[["__scopeId","data-v-b3d131f7"]]),Ie=[{name:"笑脸",emojiList:["😀","😃","😄","😁","😆","😅","🤣","😂","🙂","🙃","🫠","😉","😊","😇","🥰","😍","🤩","😘","😗","😚","😙","🥲","😋","😛","😜","🤪","😝","🤑","🤗","🤭","🫢","🫣","🤫","🤔","🫡","🤐","🤨","😐","😑","😶","🫥","😶‍🌫️","😏","😒","🙄","😬","😮‍💨","🤥","😌","😔","😪","🤤","😴","😷","🤒","🤕","🤢","🤮","🤧","🥵","🥶","🥴","😵","😵‍💫","🤯","🤠","🥳","🥸","😎","🤓","🧐","😕","🫤","😟","🙁","☹️","😮","😯","😲","😳"]},{name:"人物",emojiList:["👋","🤚","🖐️","✋","🖖","🫱","🫲","🫳","🫴","👌","🤌","🤏","✌️","🤞","🫰","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️","🫵","👍","👎","✊","👊","🤛","🤜","👏","🙌","🫶","👐","🤲","🤝","🙏","✍️","💅","🤳","💪","🦾","🦿","🦵","🦶","👂","🦻","👃","🧠","🫀","🫁","🦷","🦴","👀","👁️","👅","👄","🫦","👶","🧒","👦","👧","🧑","👱","👨","🧔","🧔‍♂️","🧔‍♀️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👩‍🦰","🧑‍🦰","👩‍🦱","🧑‍🦱","👩‍🦳","🧑‍🦳"]},{name:"动物",emojiList:["🐵","🐒","🦍","🦧","🐶","🐕","🦮","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🦬","🐮","🐂","🐃","🐄","🐷","🐖","🐗","🐽","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦣","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🦫","🦔","🦇","🐻","🐻","🐨","🐼","🦥","🦦","🦨","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🦅","🦆","🦢","🦉","🦤","🪶","🦩","🦂","🦟"]}],ge={class:"send-panel"},ke={class:"input-panel"},we={key:0,class:"comment-image"},$e={class:"op-panel"},be={class:"op-btns"},Ae={class:"emoji-list"},Le=["onClick"],Te={class:"send-btn"},Ve={key:1,class:"no-send"},xe={__name:"VideoCommentSend",props:{sendType:{type:Number},showSend:{type:Boolean,default:!0}},setup(i){const{proxy:c}=q(),u=P();H();const m=Y(),s=i,o=k({}),r=k(),a={content:[{required:!0,message:"请输入评论内容"}]},f=d=>{o.value.imgPath=d.file},A=d=>{o.value.imgPath=null},$=j("showReply"),l=async d=>{if(d.preventDefault(),Object.keys(m.userInfo).length==0){m.setLogin(!0);return}const v=s.sendType===0?{content:o.value.content,imgPath:o.value.imgPath}:Object.assign({},o.value);if(!v.content){c.Message.warning("请输入评论");return}if(v.videoId=u.params.videoId,v.imgPath){const x=await ve(v.imgPath,!0);v.imgPath=x}let L=await c.Request({url:c.Api.postComment,showLoading:!0,params:v});L&&(r.value.resetFields(),o.value={},c.Message.success("发布成功"),$(),T.emit("postCommentSuccess",L.data))},_=k(),t=k("笑脸"),n=d=>{o.value.content=o.value.content?o.value.content+d:d,_.value.hide()};return G(()=>{T.on("initCommentData",d=>{s.sendType!=0&&(o.value=Object.assign({},d))})}),te(()=>{T.off("initCommentData")}),(d,v)=>{const L=I("Avatar"),x=I("el-input"),K=I("Cover"),R=I("el-form-item"),X=I("el-form"),Q=I("el-tab-pane"),Z=I("el-tabs"),y=I("el-popover"),S=I("el-upload"),B=I("el-button");return p(),b("div",ge,[h(L,{avatar:Object.keys(w(m).userInfo).length==0?"":w(m).userInfo.avatar},null,8,["avatar"]),e("div",ke,[i.showSend?(p(),b(U,{key:0},[h(X,{model:o.value,rules:a,ref_key:"formDataRef",ref:r,onSubmit:v[1]||(v[1]=ie(()=>{},["prevent"]))},{default:g(()=>[h(R,{label:"",class:"input-area"},{default:g(()=>[h(x,{id:"inputPanel",ref:"inputRef",clearable:"",placeholder:o.value.nickName?"@"+o.value.nickName:"",modelValue:o.value.content,"onUpdate:modelValue":v[0]||(v[0]=O=>o.value.content=O),rows:1,type:"textarea",resize:"none","show-word-limit":!0,maxlength:500,autosize:{minRows:1,maxRows:5}},null,8,["placeholder","modelValue"]),o.value.imgPath?(p(),b("div",we,[h(K,{fit:"cover",source:o.value.imgPath},null,8,["source"]),e("span",{class:"del iconfont icon-close",onClick:A})])):E("",!0)]),_:1})]),_:1},8,["model"]),e("div",$e,[e("div",be,[h(y,{ref_key:"elPopoverRef",ref:_,width:500,trigger:"click","show-arrow":!1,offset:5,placement:"bottom-start"},{reference:g(()=>v[4]||(v[4]=[e("div",{class:"iconfont icon-emoji"},null,-1)])),default:g(()=>[h(Z,{modelValue:t.value,"onUpdate:modelValue":v[2]||(v[2]=O=>t.value=O),onClick:v[3]||(v[3]=ie(()=>{},["stop"]))},{default:g(()=>[(p(!0),b(U,null,W(w(Ie),O=>(p(),D(Q,{label:O.name,name:O.name},{default:g(()=>[e("div",Ae,[(p(!0),b(U,null,W(O.emojiList,le=>(p(),b("div",{class:"emoji-item",onClick:no=>n(le)},C(le),9,Le))),256))])]),_:2},1032,["label","name"]))),256))]),_:1},8,["modelValue"])]),_:1},512),h(S,{ref:"uploaderRef",multiple:!1,"show-file-list":!1,"http-request":f,accept:w(c).imageAccept},{default:g(()=>v[5]||(v[5]=[e("div",{class:"iconfont icon-image"},null,-1)])),_:1},8,["accept"])]),e("div",Te,[h(B,{type:"primary",onMousedown:l},{default:g(()=>v[6]||(v[6]=[V("发布")])),_:1})])])],64)):(p(),b("div",Ve," UP主已关闭评论区 "))])])}}},re=N(xe,[["__scopeId","data-v-2e10ee0d"]]),De={class:"comment-item"},Ee={class:"comment-content-panel"},Se={class:"nick-name-panel"},Oe={class:"comment-message"},Pe=["innerHTML"],Re={key:0,class:"image-show"},Me={class:"comment-op"},Ne={class:"op-left"},He={class:"comment-time"},Ue={class:"reply-list"},je={__name:"VideoCommentItem",props:{data:{type:Object,default:{}},replyLevel:{type:Number,default:1}},setup(i){const{proxy:c}=q(),u=P();H();const m=Y(),s=i,o=j("videoInfo"),r=t=>(t=t.replace(/\r\n/g,"<br>"),t=t.replace(/\n/g,"<br>"),t),a=j("showReply"),f=(t,n)=>{a(n==1?t.commentId:t.pCommentId),ae(()=>{const d={replyCommentId:t.commentId,nickName:t.nickName};T.emit("initCommentData",d)})},A=t=>{ee({videoId:u.params.videoId,actionType:F.COMMENT_LIKE.value,commentId:t.commentId},()=>{t.hateCountActive&&(t.hateCountActive=!1,t.hateCount--),t.likeCountActive?(t.likeCountActive=!1,t.likeCount--):(t.likeCount++,t.likeCountActive=!0)})},$=t=>{ee({videoId:u.params.videoId,actionType:F.COMMENT_HATE.value,commentId:t.commentId},()=>{t.likeCountActive&&(t.likeCountActive=!1,t.likeCount--),t.hateCountActive?(t.hateCountActive=!1,t.hateCount--):(t.hateCount++,t.hateCountActive=!0)})},l=()=>{c.Confirm({message:"确定要删除评论",okfun:async()=>{await c.Request({url:c.Api.userDelComment,params:{commentId:s.data.commentId}})&&T.emit("delCommentCallback",{pCommentId:s.data.pCommentId,commentId:s.data.commentId})}})},_=()=>{c.Confirm({message:`确定要${s.data.topType==1?"取消置顶":"置顶"}吗？`,okfun:async()=>{await c.Request({url:s.data.topType==1?c.Api.userCancelTopComment:c.Api.userTopComment,params:{commentId:s.data.commentId}})&&T.emit("topCommentCallback")}})};return(t,n)=>{const d=I("router-link"),v=I("Cover"),L=I("el-dropdown-item"),x=I("el-dropdown-menu"),K=I("el-dropdown");return p(),b("div",De,[h(pe,{width:i.replyLevel==1?50:30,avatar:i.data.avatar,userId:i.data.userId},null,8,["width","avatar","userId"]),e("div",Ee,[e("div",Se,[h(d,{to:`/user/${i.data.userId}`,class:"nick-name"},{default:g(()=>[V(C(i.data.nickName),1)]),_:1},8,["to"]),i.data.replyUserId?(p(),b(U,{key:0},[n[3]||(n[3]=e("div",{class:"reply-title"},"回复",-1)),h(d,{to:`/user/${i.data.replyUserId}`,class:"reply-nick-name"},{default:g(()=>[V(" @"+C(i.data.replyNickName),1)]),_:1},8,["to"])],64)):E("",!0)]),e("div",Oe,[i.data.topType==1?(p(),D(Ce,{key:0,type:0})):E("",!0),e("span",{innerHTML:r(i.data.content)},null,8,Pe)]),i.data.imgPath?(p(),b("div",Re,[h(v,{source:i.data.imgPath+w(c).imageThumbnailSuffix,preview:!0,fit:"cover"},null,8,["source"])])):E("",!0),e("div",Me,[e("div",Ne,[e("div",He,C(i.data.postTime),1),e("div",{class:M(["iconfont icon-good",i.data.likeCountActive?"active":""]),onClick:n[0]||(n[0]=R=>A(i.data))},C(i.data.likeCount==0?"":i.data.likeCount),3),e("div",{class:M(["iconfont icon-no-good",i.data.hateCountActive?"active":""]),onClick:n[1]||(n[1]=R=>$(i.data))},C(i.data.hateCount==0?"":i.data.hateCount),3),e("div",{class:"reply-btn",onClick:n[2]||(n[2]=R=>f(i.data,i.replyLevel))}," 回复 ")]),i.data.userId==w(m).userInfo.userId||w(o).userId==w(m).userInfo.userId?(p(),D(K,{key:0},{dropdown:g(()=>[h(x,null,{default:g(()=>[w(o).userId==w(m).userInfo.userId&&i.data.pCommentId==0?(p(),D(L,{key:0,onClick:_},{default:g(()=>[V(C(i.data.topType==1?"取消置顶":"置顶"),1)]),_:1})):E("",!0),w(o).userId==w(m).userInfo.userId||i.data.userId==w(m).userInfo.userId?(p(),D(L,{key:1,onClick:l},{default:g(()=>n[4]||(n[4]=[V("删除")])),_:1})):E("",!0)]),_:1})]),default:g(()=>[n[5]||(n[5]=e("span",{class:"op-right iconfont icon-more"},null,-1))]),_:1})):E("",!0)]),e("div",Ue,[(p(!0),b(U,null,W(i.data.children,R=>(p(),D(de,{data:R,replyLevel:2},null,8,["data"]))),256))]),i.replyLevel==1&&i.data.showReply?(p(),D(re,{key:1,sendType:1})):E("",!0)])])}}},de=N(je,[["__scopeId","data-v-5c54e4ec"]]),qe={class:"comment-panel"},Fe={class:"comment-title"},Ke={class:"title"},Be={class:"comment-count"},We={class:"comment-content-panel"},ze={class:"comment-list"},Ye={__name:"VideoComment",setup(i){const{proxy:c}=q(),u=P();H(),Y();const m=j("videoInfo"),s=ue(()=>m.value.interaction==null||m.value.interaction.indexOf("1")==-1);oe("showReply",_=>{a.value.list.forEach(t=>{t.commentId!=_?t.showReply=!1:t.showReply=!0})});const r=k(!1),a=k({}),f=k(0),A=_=>{f.value=_,$()},$=async()=>{if(!s.value)return;r.value=!0;let _=await c.Request({url:c.Api.loadComment,params:{videoId:u.params.videoId,pageNo:a.value.pageNo,orderType:f.value}});if(r.value=!1,!_)return;const t={};_.data.userActionList.forEach(L=>{t[L.commentId]=L});const d=_.data.commentData;d.list.forEach(L=>{l(t,L),L.children&&L.children.forEach(x=>{l(t,x)})});const v=a.value.list;a.value=Object.assign({},d),d.pageNo>1&&(a.value.list=v.concat(d.list))};$();const l=(_,t)=>{const n=_[t.commentId];n&&(F.COMMENT_LIKE.value==n.actionType?t.likeCountActive=!0:F.COMMENT_HATE.value==n.actionType&&(t.hateCountActive=!0))};return G(()=>{T.on("postCommentSuccess",_=>{if(_.pCommentId===0){a.value.list.unshift(_),a.value.totalCount?a.value.totalCount++:a.value.totalCount=1;return}else{const t=a.value.list.find(n=>n.commentId==_.pCommentId);if(!t)return;t.children||(t.children=[]),t.children.push(_)}}),T.on("delCommentCallback",({pCommentId:_,commentId:t})=>{if(_==0)a.value.list=a.value.list.filter(n=>n.commentId!=t),a.value.totalCount--;else{const n=a.value.list.find(d=>d.commentId==_);n.children=n.children.filter(d=>d.commentId!=t)}}),T.on("topCommentCallback",()=>{$()})}),te(()=>{T.off("postCommentSuccess"),T.off("delCommentCallback")}),(_,t)=>{const n=I("el-divider"),d=I("DataLoadMoreList");return p(),b("div",qe,[e("div",Fe,[e("div",Ke,[t[2]||(t[2]=V(" 评论")),e("span",Be,C(a.value.totalCount),1)]),e("div",{class:M(["order-type-item",f.value==0?"active":""]),onClick:t[0]||(t[0]=v=>A(0))}," 最热 ",2),h(n,{direction:"vertical"}),e("div",{class:M(["order-type-item",f.value==1?"active":""]),onClick:t[1]||(t[1]=v=>A(1))}," 最新 ",2)]),e("div",We,[h(re,{sendType:0,showSend:s.value},null,8,["showSend"]),e("div",ze,[h(d,{dataSource:a.value,loading:r.value,onLoadData:$,layoutType:"list",loadEndMsg:"没有更多评论"},{default:g(({data:v})=>[h(de,{data:v},null,8,["data"])]),_:1},8,["dataSource","loading"])])])])}}},Ge=N(Ye,[["__scopeId","data-v-46122178"]]),Xe={class:"summary-panel"},Qe=["innerHTML"],Ze={class:"tag-list"},Je={__name:"VideoSummary",setup(i){P(),H();const c=j("videoInfo"),u=k(!1),m=k(!1),s=()=>{m.value=!m.value};return fe(()=>{document.querySelector("#summary-inner").clientHeight>90?(m.value=!1,u.value=!0):(m.value=!0,u.value=!1)}),(o,r)=>{const a=I("router-link");return p(),b("div",Xe,[e("div",{class:"summary",style:z({height:m.value?"auto":"90px"})},[e("div",{class:"summary-inner",id:"summary-inner",innerHTML:w(c).introduction},null,8,Qe)],4),ne(e("div",{class:"expand-btn",onClick:s},C(m.value?"收起":"展开更多"),513),[[se,u.value]]),e("div",Ze,[(p(!0),b(U,null,W(w(c).tags,f=>(p(),D(a,{to:`/search?keyword=${f}`,class:"tag-item",target:"_blank"},{default:g(()=>[V(C(f),1)]),_:2},1032,["to"]))),256))])])}}},et=N(Je,[["__scopeId","data-v-cb8f73b6"]]),tt={class:"cion-panel"},ot={class:"title-info"},nt={class:"coin-count"},st={class:"coin-list"},at=["src"],lt=["src"],it={class:"sub-btn"},ct={__name:"VideoCoin",setup(i,{expose:c}){const{proxy:u}=q(),m=P(),s=k({show:!1,title:"投币",buttons:[]}),o=k(1),r=$=>{o.value=$},a=j("videoInfo"),f=()=>{ee({videoId:m.params.videoId,actionType:F.VIDEO_COIN.value,actionCount:o.value},()=>{a.value.coinCountActive=!0,a.value.coinCount++,s.value.show=!1,u.Message.success("投币成功")})};return c({show:()=>{s.value.show=!0,o.value=1}}),($,l)=>{const _=I("el-button"),t=I("Dialog");return p(),D(t,{show:s.value.show,buttons:s.value.buttons,width:"400px",showCancel:!1,top:200,onClose:l[2]||(l[2]=n=>s.value.show=!1)},{default:g(()=>[e("div",tt,[e("div",ot,[l[3]||(l[3]=V("给UP主投上 ")),e("span",nt,C(o.value),1),l[4]||(l[4]=V(" 枚硬币"))]),e("div",st,[e("div",{class:M(["coin-item",o.value==1?"acitve":""]),onClick:l[0]||(l[0]=n=>r(1))},[e("img",{src:w(u).Utils.getLocalImage("coin1.png")},null,8,at),l[5]||(l[5]=e("div",{class:"coin-count-inner"},"1硬币",-1))],2),e("div",{class:M(["coin-item",o.value==2?"acitve":""]),onClick:l[1]||(l[1]=n=>r(2))},[e("img",{src:w(u).Utils.getLocalImage("coin2.png")},null,8,lt),l[6]||(l[6]=e("div",{class:"coin-count-inner"},"2硬币",-1))],2)]),e("div",it,[h(_,{type:"primary",onClick:f},{default:g(()=>l[7]||(l[7]=[V("确定")])),_:1})])])]),_:1},8,["show","buttons"])}}},ut=N(ct,[["__scopeId","data-v-09cbebe8"]]),rt={class:"action-panel"},dt={__name:"VideoAction",setup(i){const c=Y(),{proxy:u}=q(),m=P();H();const s=j("videoInfo"),o=f=>{if(Object.keys(c.userInfo).length==0){c.setLogin(!0);return}ee({videoId:m.params.videoId,actionType:F[f].value},()=>{f=="VIDEO_LIKE"?s.value.likeCountActive?(s.value.likeCountActive=!1,s.value.likeCount--):(s.value.likeCountActive=!0,s.value.likeCount++):f=="VIDEO_COLLECT"&&(s.value.collectCountActive?(s.value.collectCountActive=!1,s.value.collectCount--):(s.value.collectCountActive=!0,s.value.collectCount++))})},r=k(),a=()=>{if(Object.keys(c.userInfo).length==0){c.setLogin(!0);return}if(s.value.coinCountActive){u.Message.warning("对本稿件的投币枚数已用完");return}r.value.show()};return(f,A)=>(p(),b(U,null,[e("div",rt,[e("div",{class:M(["iconfont icon-like-solid",w(s).likeCountActive?"active":""]),onClick:A[0]||(A[0]=$=>o("VIDEO_LIKE"))},C(w(s).likeCount),3),e("div",{class:M(["iconfont icon-toubi",w(s).coinCountActive?"active":""]),onClick:A[1]||(A[1]=$=>a())},C(w(s).coinCount),3),e("div",{class:M(["iconfont icon-collection-solid",w(s).collectCountActive?"active":""]),onClick:A[2]||(A[2]=$=>o("VIDEO_COLLECT"))},C(w(s).collectCount),3)]),h(ut,{ref_key:"videoCoinRef",ref:r},null,512)],64))}},mt=N(dt,[["__scopeId","data-v-31253f55"]]),vt={class:"danmu-panel"},pt={class:"danmu-list"},ft=["onClick"],_t={class:"time"},yt=["title"],ht={class:"send-time"},Ct={__name:"VideoDanmu",setup(i){const{proxy:c}=q();P(),H();const u=c.playerHeight,m=k([]);G(()=>{T.on("loadDanmu",r=>{r.sort(function(a,f){return a.time-f.time}),m.value=r})}),te(()=>{T.off("loadDanmu")});const s=k({}),o=r=>{s.value=r};return(r,a)=>{const f=I("NoData"),A=I("el-scrollbar"),$=I("Collapse");return p(),b("div",vt,[h($,null,{title:g(()=>a[0]||(a[0]=[e("div",{class:"danmu-panel-title"},[e("div",null,"弹幕列表"),e("div",{class:"iconfont icon-more"})],-1)])),default:g(()=>[e("div",pt,[a[1]||(a[1]=e("div",{class:"danmu-title danmu-item"},[e("div",{class:"time"},"时间"),e("div",{class:"content"},"弹幕内容"),e("div",{class:"send-time"},"发送时间")],-1)),h(A,{height:"400px","max-height":w(u)-60},{default:g(()=>[(p(!0),b(U,null,W(m.value,l=>(p(),b("div",{class:M(["danmu-item",l.danmuId==s.value.danmuId?"active":""]),onClick:_=>o(l)},[e("div",_t,C(w(c).Utils.convertSecondsToHMS(Math.round(l.time))),1),e("div",{class:"content",title:l.text},C(l.text),9,yt),e("div",ht,C(l.postTime),1)],10,ft))),256)),m.value.length==0?(p(),D(f,{key:0,msg:"暂无弹幕"})):E("",!0)]),_:1},8,["max-height"])])]),_:1})])}}},It=N(Ct,[["__scopeId","data-v-6868f1c1"]]),gt={key:0,class:"video-panel"},kt={class:"video-panel-title"},wt={class:"title"},$t={class:"video-count"},bt=["onClick"],At={key:0,class:"playing"},Lt=["title"],Tt={class:"duration"},Vt={__name:"VideoPList",emits:["selectVideoFile"],setup(i,{emit:c}){const{proxy:u}=q(),m=P(),s=H(),o=k(!0),r=k(m.query.p?Number.parseInt(m.query.p):1),a=k([]);(async()=>{let l=await u.Request({url:u.Api.loadVideoPList,params:{videoId:m.params.videoId}});l&&(a.value=l.data,$())})();const A=l=>{r.value=l,s.push({path:m.path,query:{p:l}}),$()},$=()=>{T.emit("changeP",a.value[r.value-1].fileId)};return G(()=>{T.on("playEnd",()=>{o.value&&a.value.length>1&&r.value<a.value.length&&A(r.value+1)})}),te(()=>{T.off("playEnd")}),(l,_)=>{const t=I("el-switch"),n=I("el-scrollbar");return a.value.length>1?(p(),b("div",gt,[e("div",kt,[e("div",wt,[_[1]||(_[1]=V(" 视频选集")),e("span",$t,"("+C(r.value)+"/"+C(a.value.length)+")",1),_[2]||(_[2]=e("span",{class:"iconfont icon-list"},null,-1))]),h(t,{modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=d=>o.value=d),"inactive-text":"自动连播"},null,8,["modelValue"])]),h(n,{"max-height":600,class:"video-list"},{default:g(()=>[(p(!0),b(U,null,W(a.value,(d,v)=>(p(),b("div",{class:M(["video-item",v==r.value-1?"active":""]),onClick:L=>A(v+1)},[v==r.value-1?(p(),b("div",At)):E("",!0),e("div",{class:"title",title:d.title}," P"+C(v+1)+" "+C(d.fileName),9,Lt),e("div",Tt,C(w(u).Utils.convertSecondsToHMS(d.duration)),1)],10,bt))),256))]),_:1})])):E("",!0)}}},xt=N(Vt,[["__scopeId","data-v-b2a2c112"]]),Dt={__name:"VideoRecommend",setup(i){const{proxy:c}=q();P(),H();const u=k([]),m=j("videoInfo");return(async()=>{let o=await c.Request({url:c.Api.getVideoRecommend,params:{keyword:m.value.videoName,videoId:m.value.videoId}});o&&(u.value=o.data)})(),(o,r)=>{const a=I("VideoItem");return p(!0),b(U,null,W(u.value,f=>(p(),D(a,{data:f,layoutType:1,marginTop:20},null,8,["data"]))),256)}}},Et={class:"player-panel"},St={class:"danmu-panel"},Ot={class:"watcher"},Pt={id:"danmu"},Rt={class:"close-danmu"},Mt={id:"play"},Nt=["src"],Ht={__name:"Player",props:{fileId:{type:String,default:""}},emits:["changeWideScreen"],setup(i,{emit:c}){const{proxy:u}=q();H();const m=P(),s=Y(),o=k();u.Api.getVideoResource;let r=null;const a=()=>{J.CONTEXTMENU=!1,J.AUTO_PLAYBACK_MAX=20,J.AUTO_PLAYBACK_MIN=10,r=new J({container:o.value,url:"",type:"m3u8",customType:{m3u8:function(y,S,B){if(ce.isSupported()){B.hls&&B.hls.destroy();const O=new ce;O.loadSource(S),O.attachMedia(y),B.hls=O,B.on("destroy",()=>O.destroy())}else y.canPlayType("application/vnd.apple.mpegurl")?y.src=S:B.notice.show="浏览器不支持该播放器"}},theme:"#23ade5",volume:.7,autoplay:!0,autoMini:!1,fullscreen:!0,fullscreenWeb:!0,setting:!0,pip:!0,playbackRate:!0,flip:!0,aspectRatio:!0,screenshot:!0,autoPlayback:!0,icons:{state:document.querySelector("#play")},controls:[{name:"wide-screen",position:"right",html:'<span class="iconfont icon-wide-screen"></span>',tooltip:"宽屏模式",style:{color:"#fff",display:"flex"},click:function(...y){$()}},{name:"narrow-screen",position:"right",html:'<span class="iconfont icon-narrow-screen"></span>',tooltip:"退出宽屏",style:{color:"#fff",display:"none"},click:function(...y){$()}}],plugins:[ye({mount:document.querySelector("#danmu"),theme:"light",emitter:!0,danmuku:function(){return new Promise(async y=>{const S=await n();return y(S)})},beforeEmit:async y=>{let S=await _(y);return n(),S?(T.emit("danmSend"),u.Message.success("发布成功"),!0):!1}})]}),r.on("hover",y=>{let S="none";y&&(S="flex"),r.template.$bottom.style.display=S}),r.on("video:ended",y=>{T.emit("playEnd")})},f=c,A=k(!1),$=()=>{A.value=!A.value,A.value?(r.controls["wide-screen"].style.display="none",r.controls["narrow-screen"].style.display="flex"):(r.controls["wide-screen"].style.display="flex",r.controls["narrow-screen"].style.display="none"),f("changeWideScreen",A.value)},l=k(),_=y=>{if(Object.keys(s.userInfo).length==0){s.setLogin(!0);return}return y.fileId=l.value,y.videoId=m.params.videoId,y.time=Math.round(y.time),u.Request({url:u.Api.postDanmu,params:y})},t=k(0),n=async()=>{if(!l.value)return[];let y=await u.Request({url:u.Api.loadDanmu,params:{fileId:l.value,videoId:m.params.videoId}});return y?(T.emit("loadDanmu",y.data),t.value=y.data.length,y.data):[]},d=k(500),v=j("playerHeight");G(()=>{ae(()=>{a();const y=Math.round((o.value.clientWidth-8)*.5625);d.value=y,v(y)}),T.on("changeP",y=>{l.value=y,R(),r.switch=`${u.Api.getVideoResource}/${y}/`,r.plugins.artplayerPluginDanmuku.load()}),x()}),_e(()=>{r&&r.destroy(!1),T.off("changeP"),X()});let L=k(null);const x=()=>{L.value=setInterval(()=>{R()},5e3)},K=k(1),R=async()=>{if(!l.value)return;let y=await u.Request({url:u.Api.reportVideoPlayOnline,params:{fileId:l.value,deviceId:s.deviceId},showError:!1});y&&(K.value=y.data)},X=()=>{L.value!==null&&(clearInterval(L.value),L.value=null)},Q=j("videoInfo"),Z=ue(()=>Q.value.interaction==null||Q.value.interaction.indexOf("0")==-1);return(y,S)=>(p(),b("div",Et,[e("div",{ref_key:"playerRef",ref:o,class:"player-style",style:z({height:d.value+"px"})},null,4),e("div",St,[e("div",Ot,C(K.value)+" 人正在看，已装填 "+C(t.value)+" 条弹幕 ",1),ne(e("div",Pt,null,512),[[se,Z.value]]),ne(e("div",Rt,"已关闭弹幕",512),[[se,!Z.value]])]),e("div",Mt,[e("img",{src:w(u).Utils.getLocalImage("play.png")},null,8,Nt)])]))}},Ut=N(Ht,[["__scopeId","data-v-bc9b5b9b"]]),jt={class:"video-detail"},qt={class:"video-header"},Ft={class:"video-title"},Kt={class:"title"},Bt={class:"video-info"},Wt={class:"iconfont icon-play2"},zt={class:"iconfont icon-danmu"},Yt={class:"iconfont"},Gt={class:"video-user-info"},Xt={class:"user-info"},Qt={class:"introduction"},Zt={class:"op-btns"},Jt={class:"focus-btn"},eo={class:"video-body"},to={class:"video-left"},oo={__name:"VideoDetail",setup(i){const c=me(),{proxy:u}=q();H();const m=P(),s=Y(),o=k({}),r=async t=>{let n=await u.Request({url:u.Api.uHomeGetUsesrInfo,params:{userId:t}});n&&(o.value=n.data)},a=async t=>{if(Object.keys(s.userInfo).length==0){s.setLogin(!0);return}await u.Request({url:t==1?u.Api.uHomeFocus:u.Api.uHomeCancelFocus,showLoading:!0,params:{focusUserId:o.value.userId}})&&(t==1?(o.value.haveFocus=!0,o.value.fansCount++):(o.value.fansCount--,o.value.haveFocus=!1))},f=k({});(async()=>{let t=await u.Request({url:u.Api.getVideoInfo,params:{videoId:m.params.videoId}});if(!t)return;r(t.data.videoInfo.userId);const n=t.data.videoInfo;let d=n.introduction||"";d=d.replace(/\r\n/g,"<br>"),d=d.replace(/\n/g,"<br>");const v=n.tags?n.tags.split(","):[];n.introduction=d,n.tags=v,f.value=n,t.data.userActionList.forEach(x=>{x.actionType==F.VIDEO_LIKE.value?f.value.likeCountActive=!0:x.actionType==F.VIDEO_COLLECT.value?f.value.collectCountActive=!0:x.actionType==F.VIDEO_COIN.value&&(f.value.coinCountActive=!0)})})(),oe("videoInfo",f);const $=k(0);oe("playerHeight",t=>{$.value=t});const l=k(!1),_=t=>{l.value=t};return G(()=>{ae(()=>{c.setShowHeader(!1),c.setFixedHeader(!0),c.setFixedCategory(!1),c.setShowCategory(!1),c.setForceFixedHeader(!0)}),T.on("danmSend",()=>{f.value.danmuCount++})}),(t,n)=>{const d=I("Avatar"),v=I("router-link"),L=I("el-button"),x=I("el-dropdown-item"),K=I("el-dropdown-menu"),R=I("el-dropdown");return p(),b("div",jt,[e("div",qt,[e("div",Ft,[e("div",Kt,C(f.value.videoName),1),e("div",Bt,[e("div",Wt,C(f.value.playCount),1),e("div",zt,C(f.value.danmuCount),1),e("div",Yt,C(f.value.createTime),1)])]),e("div",Gt,[h(d,{userId:o.value.userId,avatar:o.value.avatar},null,8,["userId","avatar"]),e("div",Xt,[h(v,{class:"nick-name",to:`/user/${o.value.userId}`,target:"_blank"},{default:g(()=>[V(C(o.value.nickName),1)]),_:1},8,["to"]),e("div",Qt,C(o.value.personIntroduction||"这个人没有填简介啊~~~"),1),e("div",Zt,[h(v,{class:"btn-go-home",to:`/user/${o.value.userId}`,target:"_blank"},{default:g(()=>n[2]||(n[2]=[V("访问主页")])),_:1},8,["to"]),e("div",Jt,[o.value.haveFocus?(p(),D(R,{key:0},{dropdown:g(()=>[h(K,null,{default:g(()=>[h(x,{onClick:n[0]||(n[0]=X=>a(-1))},{default:g(()=>n[4]||(n[4]=[V("取消关注")])),_:1})]),_:1})]),default:g(()=>[h(L,{class:"btn",type:"info",style:{width:"100%"}},{default:g(()=>[n[3]||(n[3]=e("span",{class:"iconfont icon-list"},null,-1)),V("已关注 "+C(o.value.fansCount),1)]),_:1})]),_:1})):(p(),D(L,{key:1,class:"btn",type:"primary",onClick:n[1]||(n[1]=X=>a(1))},{default:g(()=>[V("关注 "+C(o.value.fansCount),1)]),_:1}))])])])])]),e("div",eo,[e("div",to,[e("div",{class:"video-panel",style:z({position:l.value?"absolute":"static"})},[h(Ut,{ref:"playerRef",onChangeWideScreen:_},null,512)],4),e("div",{style:z({"margin-top":l.value?$.value+56+"px":"0px"})},[h(mt),h(et),Object.keys(f.value).length>0?(p(),D(Ge,{key:0})):E("",!0)],4)]),e("div",{class:"video-right",style:z({"margin-top":l.value?$.value+70+"px":"0px"})},[h(It),h(xt),Object.keys(f.value).length>0?(p(),D(Dt,{key:0})):E("",!0)],4)])])}}},Eo=N(oo,[["__scopeId","data-v-2964008f"]]);export{Eo as default};
